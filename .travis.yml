services:
  - docker

language: python

env:
  global:
  - secure: zrM0PSrKhRW2LPWFGeKlXi6kQ8rIWmsbv6GILBSNG4a4J6dQB1LfCplPRg6anGDFdbFmW+cMxEXWLpmbwmPjT9xvd6RxqtNY/bVZlLgLLstMfUv5QAOl9tIFV9YIN7g3LT/CA+aS3QckmJfTelIFStvw9uNT184OtAy+O0jmB5cgv7SzWQf5RuV95RNgTgJ/YNDNRuKgvlEORiTxke1Jg/62lVQEbDbv4j03OoNkZLpR50DR35fvBGmu6k/BlL+s6tgr0KQbKaafQbrHcgJkyQPxFaqv9DnBh9y8RITfE+c456KD+J3hL4X/tgkjOosDW15gT6aYbYkBaP7WFsv60B71v86eoXnqpXxL/k1+/8T6hU8K+ax0E6Uzw7sdb6wgc7Cgrp5mCwcEtTHduCBhQHBCGiGwADH5YF/+XUXTT41OH1w4I3aZxayG29kWu5YG9hoDcZPvdN4ckqJkI75PB7d9iuwmkmhqLY/2nG45ceaGVqfY+qWA6TZATUdnm0bSM7rK49aE8juLeXlP8kOuLVogD1NWYSbyYm0NXHswJr4slhVxOoRTmyKN1aGxK/ArwyDKnfMlCtIOyzgEY8sEmi9DndyBt3b2FbErCLs8eLhHRiN9pCPtgXwn7U5e3F8O/szcgzCv9pBgIMd5MJEuzvLPj+hbIvkbJzKuf6H6/fU=
  - secure: QQF521dbXghZMNErJovjTWdf7voH9qD98ufcPvvCiQebO9UHLvyM248+rJ4iFybB1JUFU9Q54Y5mPLaKF8W764K4LtgSAB+mMSszrFsXKrTP5PCaazuq+2a1cFYrtKI2Vjj9v9aPrSneWNxnx8HBZVQcSgjDuAK42YFJNHvNtOgJzyJs1P4C/SMqjWHzF4/22y9sf2Qa8o8JFQD701dt9xjR9ih3Pz9PBYxYdlRoWSbfWWsve3DWVIW69U6cSiswaj+Xw4HVw05KSgi0KHM8P93uxTjsfvA8gVBt82ZVXfjyXaIk91SdXBYpx9mhJR8+Z5KkFOmkl9Six3M2/KB5op7Kdw9QMbpBDYJKpjv4XneOSy1JMwgdLf+4RS3ecxwmZ6z9rNhwzqrKfoZPmY++Qd+S/dOtwjlO1EBHB/msDoNIXK/+Da0/GvihyZKLt/IaChh9tvk003PcpoE8vQW/B7yN/wDUFSJQDnkHjlwmjiguUtyjO5Yy9FhQjFFB48KR8Zr9Y+dPBCLlSvSKmt3mSi8UttiXEU1y+GlDOA1ZjiquuiPkRDZM3dOIBbMckzbULLO+YhaN4U/EhA4/vAQaYxUfVRE+r8km5VqbNNnBOoJN0r3cvSGmwL0YtaltInSNcbHsfpKG+xxf6rxdxaoZLKtGL5eUWP88eu/K+P7uwlo=
  - secure: vsb1b9UE8LNgdfW1Oibye2cMR7okg2Fe1C4hMk2o3Sko9kYy6/+WMxD7MS6E9JTG779xvmSqQpt/TiS289+AZIFs3h15JQw+BbhnPr0eL0ruzMyZzMaBt/ajyta/0W9xpgVHlvzVyWVt65MNZJLhSGyTVRuADClSqq/C602qCoye14uMgXFRy8vy4o0GzrXoxp17gnil68BHKmMJ9wVWuxNOkGw3SEzCOz2bgYuQ02/2vXZjGhGIsFkAVmo2mZD8M4QsFm8oy7YLR9fL/F2R9F9WoZP+EI9oSNFLnXm9psodQapYaT4Y+EaPi/GpocN9yYE8dJM19SELt5Vhv9100ob5ExpwSXF7Ns3UAY7+8EotABiW0EhYQ8LnCXNfvq2kF/L/dn0VSvLxtjkm4oZlzgMhGGlWHo3qG4lUfqy81HPc97vilYPxTF0WLhRCAbdcRvg35T+C1rMER3tqgyEv57IVpN50ckFI1zslzg81Tg/9Yec2c+3ZsIcHG7t+HSWNr8sIZs5SER1uA+wspzqnmVycMIDNCgtcMG3qTX3hs5of+86O+Q/ZyiRCNuH0Xd7uipocEExWsV034UDf9rUbun3ODy4am3C5sAKWMCExQE0MsAXCyJUSBUdn9W35T6puUBfsfm2hPNpML7cgPqpmz1SB/4Cy1yilFQ7KrQA9ZXI=
  - COMMIT=${TRAVIS_COMMIT::8}

after_success:
  - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
  - export REPO=fredprod/salt
  - export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH ; fi`
  - docker build -f Dockerfile -t $REPO:$COMMIT .
  - docker tag $REPO:$COMMIT $REPO:$TAG
  - docker tag $REPO:$COMMIT $REPO:travis-$TRAVIS_BUILD_NUMBER
  - docker push $REPO
